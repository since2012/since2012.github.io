(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{111:function(t,a,s){"use strict";s.r(a);var n=s(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"jpa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jpa","aria-hidden":"true"}},[t._v("#")]),t._v(" jpa")]),s("h2",{attrs:{id:"表关联"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表关联","aria-hidden":"true"}},[t._v("#")]),t._v(" 表关联")]),s("p",[t._v("User 表和 Role表建立多对多关系。")]),s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Entity")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@EqualsAndHashCode")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callSuper "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@NoArgsConstructor")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Table")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("indexes "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Index")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"user_name_unique"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columnList "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"name"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" unique "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("br"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("BaseEntity")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),s("br"),s("br"),t._v("\t"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" serialVersionUID "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("L"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("br"),t._v("\t"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" String name"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("br"),t._v("\t"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" String nick"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("br"),t._v("\t"),s("span",{attrs:{class:"token comment"}},[t._v("/**"),s("br"),t._v("\t * 角色"),s("br"),t._v("\t */")]),s("br"),t._v("\t"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@ManyToMany")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fetch "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" FetchType"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EAGER "),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("br"),t._v("\t"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@JoinTable")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"link_user_role"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("br"),t._v("\t\t\tjoinColumns"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@JoinColumn")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"user_id"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("referencedColumnName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"id"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("br"),t._v("\t\t\tinverseJoinColumns"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@JoinColumn")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"role_id"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("referencedColumnName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"id"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("br"),t._v("\t"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" List"),s("span",{attrs:{class:"token generics function"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Role"),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" roles"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("br")])]),s("p",[t._v("Role:")]),s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Entity")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@EqualsAndHashCode")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callSuper "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("br"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@NoArgsConstructor")]),s("br"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Role")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("BaseEntity")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),s("br"),s("br"),t._v("    "),s("span",{attrs:{class:"token comment"}},[t._v("/**"),s("br"),t._v("     * 角色名称"),s("br"),t._v("     */")]),s("br"),t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" String name"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("br"),t._v("    "),s("span",{attrs:{class:"token comment"}},[t._v("/**"),s("br"),t._v("     *  角色类型"),s("br"),t._v("     */")]),s("br"),t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" type"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("br"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("br")])]),s("p",[t._v("会自动创建表 "),s("code",[t._v("LINK_USER_ROLE")]),t._v(" , 里面2个字段，为 "),s("code",[t._v("user_id")]),t._v(" 和 "),s("code",[t._v("role_id")])]),s("p",[s("code",[t._v("ManyToMany")]),t._v(" 如果不带 "),s("code",[t._v("fetch = FetchType.EAGER")]),t._v("，报以下错误：")]),s("blockquote",[s("p",[t._v("failed to lazily initialize a collection of role: cn.xiaowenjie.common.rbac.User.roles, could not initialize proxy - no Session")])])])}],!1,null,null,null);a.default=o.exports}}]);